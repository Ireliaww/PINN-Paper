# Two-Region MHD Channel Flow: PINN & GPINN Solver

> A Physics-Informed Neural Network (PINN) and Gradient-enhanced PINN (GPINN) framework for solving the coupled magnetohydrodynamic (MHD) channel-flow equations in a two-fluid, rotating domain — with a classical BVP reference solver for validation.

---

## Table of Contents

1. [Problem Description](#1-problem-description)
2. [Mathematical Formulation](#2-mathematical-formulation)
3. [Project Structure](#3-project-structure)
4. [Method Overview](#4-method-overview)
5. [Dependencies & Installation](#5-dependencies--installation)
6. [Running the Code](#6-running-the-code)
7. [Configuration](#7-configuration)
8. [BVP Reference Solver](#8-bvp-reference-solver)
9. [Output Files](#9-output-files)
10. [References](#10-references)

---

## 1. Problem Description

We consider fully-developed, laminar flow of two immiscible electrically-conducting fluids between two infinite parallel plates at $y = -1$ and $y = +1$.  The channel is divided at $y = 0$:

| Region | Domain | Fluid Type |
|--------|--------|------------|
| Region 1 | $y \in [0,\, 1]$ | Newtonian |
| Region 2 | $y \in [-1,\, 0]$ | Casson (non-Newtonian) |

The system is subject to:
- An inclined external magnetic field at angle $\theta$ to the $y$-axis (Hartmann effect)
- Rotation about the $y$-axis (Coriolis force)
- Buoyancy-driven natural convection (Grashof number)
- Thermal radiation and viscous/Ohmic dissipation
- Homogeneous chemical reaction of order $n$

Five field variables are solved in each region:

| Variable | Symbol | Physical meaning |
|----------|--------|-----------------|
| Axial velocity | $u(y)$ | Primary flow velocity in the $x$-direction |
| Transverse velocity | $w(y)$ | Secondary flow velocity in the $z$-direction due to rotation |
| Induced magnetic field | $b(y)$ | Perturbation field generated by the current-carrying fluid |
| Temperature | $\theta(y)$ | Non-dimensional fluid temperature |
| Species concentration | $g(y)$ | Non-dimensional concentration of a diffusing chemical species |

---

## 2. Mathematical Formulation

All equations are given in non-dimensional form.  Let $\lambda = \cos\theta$.

### Region 1 (Newtonian, $y \in [0,1]$)

$$u_1'' + G_1 - Ha_1^2(K + \lambda u_1)\lambda - 2\omega_1 w_1 + Gr_1(\theta_1 + k_{b1}\theta_1^2) = 0$$
$$w_1'' + G_1 - Ha_1^2\!\left[\lambda^2 + (b_1 + \sin\theta)^2\right] + 2\omega_1 u_1 = 0$$
$$b_1'' + \lambda\, Rm_1\, u_1' = 0$$
$$(1 + 4Rd_1)\,\theta_1'' + Pr_1 Ec_1(u_1'^2 + w_1'^2) + Ha_1^2 Pr_1 Ec_1(K + \lambda u_1)^2 = 0$$
$$g_1'' - Sc_1\,\eta_1\,g_1^n = 0$$

### Region 2 (Casson, $y \in [-1,0]$)

The Casson constitutive factor $(1 + 1/\beta)$ modifies the momentum equations:

$$(1+1/\beta)\,u_2'' + G_2 - Ha_2^2(K + \lambda u_2)\lambda - 2\omega_2 w_2 + Gr_2(\theta_2 + k_{b2}\theta_2^2) = 0$$
$$(1+1/\beta)\,w_2'' + G_2 - Ha_2^2\!\left[\lambda^2 + (b_2 + \sin\theta)^2\right] + 2\omega_2 u_2 = 0$$
$$b_2'' + \lambda\, Rm_2\, u_2' = 0$$
$$(1 + 4Rd_2)\,\theta_2'' + Pr_2 Ec_2(u_2'^2 + w_2'^2) + Ha_2^2 Pr_2 Ec_2(K + \lambda u_2)^2 = 0$$
$$g_2'' - Sc_2\,\eta_2\,g_2^n = 0$$

### Boundary Conditions

| Location | Condition |
|----------|-----------|
| $y = +1$ (right wall) | $u_1=1,\ w_1=0,\ b_1=0,\ \theta_1=1,\ g_1=1$ |
| $y = -1$ (left wall)  | $u_2=0,\ w_2=0,\ b_2=0,\ \theta_2=0,\ g_2=0$ |
| $y = 0$ (interface, value continuity) | $u_1=u_2,\ w_1=w_2,\ b_1=b_2,\ \theta_1=\theta_2,\ g_1=g_2$ |
| $y = 0$ (interface, flux jump) | $u_1'=(1+1/\beta)u_2',\quad b_1'=\delta\beta_1\gamma b_2',\quad \theta_1'=(\beta_1/\varepsilon)\theta_2',\quad g_1'=(\beta_1/\varphi)g_2'$ |

### Dimensionless Parameter Reference

| Symbol | Name | Description |
|--------|------|-------------|
| $Ha$ | Hartmann number | Ratio of electromagnetic to viscous force |
| $Gr$ | Grashof number | Ratio of buoyancy to viscous force |
| $Pr$ | Prandtl number | Ratio of momentum to thermal diffusivity |
| $Ec$ | Eckert number | Kinetic energy relative to enthalpy: controls viscous dissipation |
| $Sc$ | Schmidt number | Ratio of momentum to mass diffusivity |
| $Rd$ | Radiation parameter | Relative contribution of radiation heat flux |
| $Rm$ | Magnetic Reynolds number | Ratio of magnetic advection to diffusion |
| $\beta$ | Casson number | Non-Newtonian yield-stress parameter; $\beta\to\infty$ recovers Newtonian flow |
| $\omega$ | Rotation parameter | Coriolis force strength |

---

## 3. Project Structure

```
PINN-Paper/
│
├── config/
│   └── params.py           # All physical constants and training hyperparameters
│
├── data/
│   └── collocation.py      # Collocation point generation (returns CollocationData)
│
├── pinn/
│   ├── network.py          # Neural network architectures: PINNNet, GPINNNet
│   ├── losses.py           # PDE residuals, boundary and interface losses
│   └── trainer.py          # Adam → L-BFGS training + ThresholdTracker
│
├── bvp/
│   └── solver.py           # Classical BVP reference solver (scipy.integrate.solve_bvp)
│
├── utils/
│   └── visualization.py    # Loss plots, field-profile plots, convergence table
│
├── outputs/                # Auto-created; stores model weights (.pt) and figures (.png)
│
├── main.py                 # Top-level entry point
├── README.md               # This file
└── Test1 copy.py           # Original monolithic script (kept for reference)
```

---

## 4. Method Overview

### PINN (Physics-Informed Neural Network)
A fully-connected MLP with `tanh` activation approximates all 10 field variables simultaneously.  The training minimises:

$$\mathcal{L}_{\text{PINN}} = \underbrace{0.1\,\mathcal{L}_{\text{PDE}_1} + 0.1\,\mathcal{L}_{\text{PDE}_2}}_{\text{interior residuals}} + \underbrace{\mathcal{L}_{\text{BC}^+} + \mathcal{L}_{\text{BC}^-} + \mathcal{L}_{\text{IC}}}_{\text{boundary \& interface}}$$

where each term is an MSE (Mean Squared Error) loss enforcing the corresponding condition.

### GPINN (Gradient-enhanced PINN)
In addition to the PINN loss, GPINN adds the **y-derivative of each PDE residual** as extra constraints:

$$\mathcal{L}_{\text{GPINN}} = \mathcal{L}_{\text{PDE}_1} + \mathcal{L}_{\partial\text{PDE}_1} + \mathcal{L}_{\text{PDE}_2} + \mathcal{L}_{\partial\text{PDE}_2} + \mathcal{L}_{\text{BC}^+} + \mathcal{L}_{\text{BC}^-} + \mathcal{L}_{\text{IC}}$$

This gradient-enhancement typically leads to faster convergence and better accuracy, at the cost of computing 3rd-order automatic derivatives during training.

### Two-Phase Optimiser
1. **Phase 1 — Adam** (`ADAM_EPOCHS` iterations): rapid descent from random initialisation.
2. **Phase 2 — L-BFGS** (`LBFGS_MAX_ITER` steps): fine-grained quasi-Newton refinement.

### BVP Reference Solver
`scipy.integrate.solve_bvp` is used to solve each sub-domain ODE system on an adaptive mesh, providing a ground-truth reference for PINN/GPINN accuracy assessment.

---

## 5. Dependencies & Installation

Requires Python ≥ 3.8.

```bash
pip install torch numpy scipy matplotlib
```

| Package | Role |
|---------|------|
| `torch` | Neural network training, automatic differentiation |
| `numpy` | Array operations, BVP initial guesses |
| `scipy` | `solve_bvp` classical reference solver |
| `matplotlib` | Plotting loss curves and field profiles |

---

## 6. Running the Code

```bash
cd /path/to/PINN-Paper

# Run the full pipeline (BVP solve + PINN/GPINN training + plotting)
python main.py
```

Progress is printed to the console at every 100 epochs (Adam) and 100 L-BFGS steps.  Trained model weights and figures are saved to `outputs/`.

---

## 7. Configuration

Open `config/params.py` to adjust:

- **Physical parameters**: `Ha1`, `Ha2`, `Gr1`, `Gr2`, `beta`, `theta`, `n`, etc.
- **λ sweep**: `LAMDAS = [0.5]` — extend to e.g. `[0.3, 0.5, 0.7]` to compare inclination angles.
- **Training budget**: `ADAM_EPOCHS`, `LBFGS_MAX_ITER`, `LR_ADAM`.
- **Collocation density**: `N_COLLOC` (default 100 points per region).

No other files need to be modified for a parameter study.

---

## 8. BVP Reference Solver

The classical solver in `bvp/solver.py` uses a **domain-decomposition** strategy:

1. **Region 1** ($y \in [0,1]$): solved independently using Dirichlet conditions at $y=1$ and guessed interface values at $y=0$.
2. **Interface propagation**: the Region 1 solution at $y=0$ is used to compute the Region 2 boundary values via the flux-jump conditions.
3. **Region 2** ($y \in [-1,0]$): solved with Dirichlet conditions at $y=-1$ and matched interface values.

The BVP solver provides a **mesh-free validation** reference: if PINN and GPINN converge to the same profile as `solve_bvp`, the neural network solutions are physically correct.

> **Note**: `solve_bvp` may fail to converge for strongly nonlinear parameter regimes (high $Ha$, high $Gr$, large $n$).  In that case the BVP curves are omitted from the plots, but PINN/GPINN training is unaffected.

---

## 9. Output Files

All outputs are written to `outputs/`:

| File | Description |
|------|-------------|
| `GPINNmodel_lamda<λ>.pt` | Trained GPINN weights (PyTorch state dict) |
| `PINNmodel_lamda<λ>.pt` | Trained PINN weights |
| `loss_curves_lamda<λ>.png` | Training loss vs. epoch (log scale) |
| `field_profiles_lamda<λ>.png` | Spatial profiles: PINN vs. GPINN vs. BVP |

Model weights can be reloaded for inference:
```python
from pinn.network import PINNNet
net = PINNNet()
net.load_state_dict(torch.load("outputs/PINNmodel_lamda0.5.pt"))
net.eval()
```

---

## 10. References

1. Raissi, M., Perdikaris, P., & Karniadakis, G. E. (2019). Physics-informed neural networks: A deep learning framework for solving forward and inverse problems involving nonlinear partial differential equations. *Journal of Computational Physics*, 378, 686–707.

2. Yu, J., Lu, L., Meng, X., & Karniadakis, G. E. (2022). Gradient-enhanced physics-informed neural networks for forward and inverse PDE problems. *Computer Methods in Applied Mechanics and Engineering*, 393, 114823.

3. Kingma, D. P., & Ba, J. (2014). Adam: A method for stochastic optimization. *arXiv preprint arXiv:1412.6980*.

4. Liu, D. C., & Nocedal, J. (1989). On the limited memory BFGS method for large scale optimization. *Mathematical Programming*, 45(1–3), 503–528.

5. Shampine, L. F., Kierzenka, J., & Reichelt, M. W. (2000). Solving boundary value problems for ordinary differential equations in MATLAB with `bvp4c`. *Tutorial notes*, 2000, 1–27.
